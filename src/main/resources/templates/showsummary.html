<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>Geekmonkey — Picklist</title>

    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>

    <style>
        :root{
          --bg:#F9FAFB; --card:#FFFFFF; --stroke:#E5E7EB; --text:#111827; --muted:#6B7280;
          --accent:#FF7A00; --accent-ink:#9A4D00; --radius:16px;
        }
        html,body{height:100%}
        body{background:var(--bg); color:var(--text); -webkit-font-smoothing:antialiased}

        /* Header */
        .gm-header{position:sticky; top:0; z-index:1000; background:#fff; border-bottom:1px solid var(--stroke)}
        .gm-brand{display:flex; align-items:center; gap:.6rem; font-weight:800; color:var(--text); text-decoration:none}
        .gm-dot{width:28px; height:28px; border-radius:10px; background:var(--accent); box-shadow:0 8px 18px rgba(255,122,0,.25)}
        .btn-ghost{background:#fff; border:1px solid var(--stroke); color:var(--text); border-radius:12px}
        .btn-ghost:hover{background:#fdfdfd; border-color:#d6d9de}
        .btn-accent{background:var(--accent); color:#fff; border:0; border-radius:12px}
        .btn-accent:hover{background:#ff8f29}

        /* Cards */
        .gm-card{background:var(--card); border:1px solid var(--stroke); border-radius:var(--radius); box-shadow:0 4px 16px rgba(17,24,39,.04)}
        .muted{color:var(--muted)}
        .pill{display:inline-flex; align-items:center; gap:.35rem; padding:.25rem .6rem; border-radius:999px; border:1px solid transparent; font-weight:600; font-size:.75rem}
        .pill-urg{background:#fee2e2; color:#7f1d1d; border-color:#fecaca}
        .pill-pri{background:#fef3c7; color:#78350f; border-color:#fde68a}
        .pill-nrm{background:#dcfce7; color:#064e3b; border-color:#bbf7d0}

        .thumb{width:100%; height:100%; object-fit:cover; border-radius:12px}

        /* Sticky footer */
        .gm-footer{position:sticky; bottom:0; z-index:1020; background:#fff; border-top:1px solid var(--stroke)}
        .progress-wrap{height:.75rem; background:#e5e7eb; border-radius:999px; overflow:hidden}
        .progress-bar-gm{background:var(--accent)}

        /* Mobile container size */
        .maxw-sm{max-width:560px}
    </style>
</head>
<body>

<!-- Header -->
<nav class="gm-header">
    <div class="container maxw-sm d-flex align-items-center justify-content-between py-2">
        <a class="gm-brand" href="/v1/home" aria-label="Geekmonkey Home">
            <span class="gm-dot" aria-hidden="true"></span><span>Geekmonkey</span>
        </a>
        <div class="d-flex gap-2">
            <button id="gmBackBtn" type="button" class="btn btn-ghost btn-sm me-2">← Back</button>
            <a href="/v1/home" class="btn btn-accent btn-sm">⌂ Home</a>
        </div>
    </div>

    <!-- Page title + quick action -->
    <div class="container maxw-sm py-2 pt-0">
        <div class="d-flex align-items-center justify-content-between">
            <div>
                <h1 class="h5 fw-bold mb-0">Picklist</h1>
                <div class="small text-muted">Mobile</div>
            </div>
            <button type="button" class="btn btn-accent btn-sm">Scan</button>
        </div>

        <!-- Search -->
        <form th:action="@{/picklist}" method="get" class="mt-2">
            <div class="position-relative">
                <input name="q" th:value="${q}" class="form-control" placeholder="Search by product name or variation ID…"/>
                <span class="position-absolute top-50 end-0 translate-middle-y me-3 text-muted small">⌘K</span>
            </div>
        </form>
    </div>
</nav>

<!-- Content -->
<main class="container maxw-sm pb-5 pt-3">

    <!-- Empty -->
    <div th:if="${#lists.isEmpty(items)}" class="text-center muted py-5">
        No items found.
    </div>

    <!-- Hidden Mark All form -->
    <form th:action="@{/picklist/markAll}" method="post" th:if="${!#lists.isEmpty(items)}" class="d-none" id="markAllForm">
        <input type="hidden" name="q" th:value="${q}"/>
        <div th:each="it : ${items}">
            <input type="checkbox" name="ids" th:value="${it.id}" th:checked="${it.picked}"/>
        </div>
    </form>

    <!-- Items -->
    <div th:each="it : ${items}" class="gm-card p-3 mb-3">
        <div class="d-flex gap-3">
            <div style="width:84px; height:84px;" class="flex-shrink-0">
                <img th:src="${it.imageUrl}" th:alt="${it.name}" class="thumb border"/>
            </div>

            <div class="flex-grow-1">
                <div class="d-flex align-items-start justify-content-between">
                    <div class="pe-2">
                        <div class="fw-semibold" th:text="${it.name}">Product Name</div>
                        <div class="small text-muted">Variation ID: <span th:text="${it.variationId}">VAR123</span></div>
                    </div>

                    <!-- Priority pill -->
                    <span th:classappend="${it.priority.name()=='HIGH'} ? ' pill-urg' : (${it.priority.name()=='MEDIUM'} ? ' pill-pri' : ' pill-nrm')"
                          class="pill">
            <span th:if="${it.priority.name()=='HIGH'}">Urgent</span>
            <span th:if="${it.priority.name()=='MEDIUM'}">Priority</span>
            <span th:if="${it.priority.name()=='LOW'}">Normal</span>
          </span>
                </div>

                <div class="d-flex align-items-center justify-content-between mt-2 mb-1">
                    <div class="small">
                        <span class="text-muted">Qty:</span>
                        <span class="fs-5 fw-bold ms-1" th:text="${it.qty}">1</span>
                    </div>

                    <form th:action="@{/v1/order/picklist/toggle}" method="post" class="ms-2">
                        <input type="hidden" name="id" th:value="${it.id}"/>
                        <input type="hidden" name="q" th:value="${q}"/>
                        <button
                                th:classappend="${it.picked} ? ' btn-accent' : ' btn-ghost'"
                                class="btn btn-sm fw-semibold">
                            <span th:text="${it.picked} ? 'Picked' : 'Mark Picked'">Mark Picked</span>
                        </button>
                    </form>
                </div>

                <div class="small text-muted">Storage: <span th:text="${it.storage}">Aisle B</span></div>
            </div>
        </div>
    </div>

</main>

<!-- Sticky Footer -->
<footer class="gm-footer">
    <div class="container maxw-sm py-3">
        <div class="d-flex align-items-center justify-content-between small">
            <div class="fw-semibold">
                Picked <span th:text="${picked}">0</span> of <span th:text="${total}">0</span>
            </div>
            <div class="text-muted">
                Remaining <span th:text="${total - picked}">0</span>
            </div>
        </div>

        <div class="progress-wrap mt-2">
            <div class="progress-bar-gm" style="height:100%;"
                 th:style="'width:' + (${total} > 0 ? ((${picked} * 100) / ${total}) : 0) + '%;'">
            </div>
        </div>

        <div class="d-flex gap-2 pt-2">
            <button form="markAllForm" class="btn btn-accent flex-grow-1">Mark All Picked</button>
            <a th:href="@{/v1/order/picklist}" class="btn btn-ghost">Reset Filters</a>
        </div>
    </div>
</footer>

<!-- Back/Home JS + Bootstrap -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
    (function(){
      const backBtn = document.getElementById('gmBackBtn');
      if(backBtn){
        backBtn.addEventListener('click', function(){
          if (history.length > 1) { try { history.back(); return; } catch(e){} }
          location.href = '/v1/home';
        });
      }
    })();
</script>
</body>
</html>
