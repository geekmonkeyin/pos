<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Login — Geekmonkey Console</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
  <style>
    :root{
      /* same theme */
      --bg:#F9FAFB; --card:#fff; --stroke:#E5E7EB; --text:#111827; --muted:#6B7280;
      --accent:#FF7A00; --ok:#065F46; --warn:#B45309; --err:#B91C1C; --radius:14px;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font:14px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif}
    header{display:flex;align-items:center;gap:12px;background:#fff;border-bottom:1px solid var(--stroke);height:64px;padding:0 20px}
    .logo{width:32px;height:32px;border-radius:8px;background:var(--accent);display:grid;place-items:center;color:#fff;font-weight:700}

    /* Layout */
    main{min-height:calc(100vh - 64px);display:grid;place-items:center;padding:24px}
    .auth{width:min(420px,92vw);background:var(--card);border:1px solid var(--stroke);border-radius:var(--radius);box-shadow:0 10px 30px rgba(0,0,0,.04);padding:20px}
    .title{font-weight:800;font-size:18px;margin:6px 0 2px}
    .sub{color:var(--muted);font-size:12px;margin-bottom:14px}

    .field{display:grid;gap:6px;margin:8px 0}
    .field label{font-size:12px;color:var(--muted)}
    .input{display:flex;align-items:center;border:1px solid var(--stroke);border-radius:10px;background:#fff;height:40px;padding:0 10px;gap:8px}
    .input input{flex:1;border:0;outline:0;height:100%;font:inherit;background:transparent;color:var(--text)}
    .input .icon{color:#9CA3AF}
    .msg{font-size:12px;margin-top:4px}
    .msg.err{color:var(--err)}

    .row{display:flex;align-items:center;justify-content:space-between;gap:8px;margin:6px 0}
    .btn{height:40px;padding:0 14px;border:none;border-radius:10px;background:var(--accent);color:#fff;font-weight:600;cursor:pointer}
    .btn.secondary{background:#fff;color:var(--text);border:1px solid var(--stroke)}
    .btn.full{width:100%}

    .hr{display:grid;grid-template-columns:1fr auto 1fr;align-items:center;color:var(--muted);gap:10px;margin:12px 0}
    .hr::before,.hr::after{content:"";height:1px;background:var(--stroke)}

    .meta{display:flex;gap:8px;justify-content:space-between;align-items:center}
    .meta a{font-size:12px;color:#1F2937;text-decoration:none}
    .meta a:hover{opacity:.8}

    .foot{margin-top:10px;font-size:12px;color:var(--muted);text-align:center}

    /* Show/Hide password toggle */
    .eye{cursor:pointer;color:#9CA3AF}

    /* Spinner Overlay */
    #spinnerOverlay{
      position:fixed;inset:0;background:rgba(17,24,39,.55);backdrop-filter:blur(2px);display:none;
      align-items:center;justify-content:center;z-index:2000;color:#fff;flex-direction:column;gap:16px;
    }
    .spinner{width:84px;height:84px;border-radius:50%;border:6px solid rgba(255,255,255,.2);border-top:6px solid var(--accent);animation:spin 1.1s linear infinite;box-shadow:0 0 24px rgba(255,122,0,.35),0 0 60px rgba(255,122,0,.2)}
    @keyframes spin{to{transform:rotate(360deg)}}
    .joke{font-size:14px;color:#fff;max-width:360px;text-align:center}

    /* Tiny helper badges */
    .badge{display:inline-grid;place-items:center;padding:2px 8px;border:1px solid var(--stroke);border-radius:999px;font-size:11px;color:var(--muted)}
  </style>
</head>
<body>
  <header>
    <div class="logo">GM</div>
    <div style="font-weight:600">Geekmonkey — Secure Login</div>
  </header>

  <main>
    <form id="loginForm" class="auth" method="post" th:action="@{/login}">
      <div class="badge">Admin Console</div>
      <div class="title">Welcome back</div>
      <div class="sub">Sign in to continue to your dashboard</div>

      <div class="field">
        <label for="email">Email</label>
        <div class="input"><i class="far fa-envelope icon" aria-hidden="true"></i>
          <input id="email" name="username" type="email" autocomplete="username" placeholder="you@geekmonkey.in" required />
        </div>
        <div id="emailMsg" class="msg"></div>
      </div>

      <div class="field">
        <label for="password">Password</label>
        <div class="input">
          <i class="fas fa-lock icon" aria-hidden="true"></i>
          <input id="password" name="password" type="password" autocomplete="current-password" placeholder="••••••••" required />
          <i id="togglePwd" class="far fa-eye eye" title="Show/Hide"></i>
        </div>
        <div id="pwdMsg" class="msg"></div>
      </div>

      <div class="meta">
        <label style="display:flex;align-items:center;gap:8px"><input id="remember" name="remember-me" type="checkbox"/> <span class="hint">Remember me</span></label>
        <a href="#" th:href="@{/forgot}">Forgot password?</a>
      </div>

      <button class="btn full" type="submit" id="loginBtn">Sign in</button>

      <div class="hr">or</div>
      <div class="row" style="gap:10px">
        <button class="btn secondary" type="button" id="googleBtn"><i class="fab fa-google" aria-hidden="true"></i> &nbsp; Google</button>
        <button class="btn secondary" type="button" id="microsoftBtn"><i class="fab fa-microsoft" aria-hidden="true"></i> &nbsp; Microsoft</button>
      </div>

      <div class="foot">No account? <a href="#" th:href="@{/signup}">Create one</a></div>
    </form>
  </main>

  <!-- Spinner Overlay -->
  <div id="spinnerOverlay">
    <div class="spinner" aria-hidden="true"></div>
    <div class="joke" id="spinnerText">Checking tickets with Kakashi…</div>
  </div>

  <script>
    // anime-flavored lines
    const jokes=[
      "Opening the Gates (of login)…",
      "Summoning ramen bowls for energy…",
      "Breathing forms loading…",
      "Charging Sharingan (2FA)…",
      "Calling Gojo for Infinity shield…",
      "Bankai prep complete… authenticating…"
    ];
    function randomJoke(){return jokes[Math.floor(Math.random()*jokes.length)];}

    const form = document.getElementById('loginForm');
    const overlay = document.getElementById('spinnerOverlay');
    const spinnerText = document.getElementById('spinnerText');
    const emailEl = document.getElementById('email');
    const pwdEl = document.getElementById('password');
    const emailMsg = document.getElementById('emailMsg');
    const pwdMsg = document.getElementById('pwdMsg');

    // show/hide password
    document.getElementById('togglePwd').addEventListener('click',()=>{
      const t = pwdEl.getAttribute('type')==='password' ? 'text' : 'password';
      pwdEl.setAttribute('type', t);
    });

    function showOverlay(){ overlay.style.display='flex'; spinnerText.textContent=randomJoke(); spinRotate(); }
    function hideOverlay(){ overlay.style.display='none'; clearInterval(spinTimer); }

    // rotate text while visible
    let spinTimer=null; function spinRotate(){ clearInterval(spinTimer); spinTimer=setInterval(()=>{ spinnerText.textContent=randomJoke(); }, 2500); }

    // basic client-side validation (also enforced by browser for type=email)
    function validEmail(v){ try{ return v && v.includes('@') && v.includes('.'); }catch{ return false; } }
    function validPwd(v){ return (v||'').length >= 6; }

    form.addEventListener('submit', async (e)=>{
      e.preventDefault();
      const email = emailEl.value.trim();
      const pwd = pwdEl.value.trim();

      // reset messages
      emailMsg.textContent = ''; pwdMsg.textContent = '';

      let ok=true;
      if(!validEmail(email)){ emailMsg.textContent='Enter a valid email'; emailMsg.className='msg err'; ok=false; }
      if(!validPwd(pwd)){ pwdMsg.textContent='Minimum 6 characters'; pwdMsg.className='msg err'; ok=false; }
      if(!ok) return;

      showOverlay();
      try{
        // If using Spring Security form-login, keep th:action and submit natively:
        // form.submit(); return;

        // JSON login example (adjust endpoint to your backend):
        const res = await fetch('/api/auth/login',{
          method:'POST', headers:{'Content-Type':'application/json'},
          body: JSON.stringify({ username: email, password: pwd, remember: document.getElementById('remember').checked })
        });
        if(res.ok){
          // redirect after successful login
          window.location.href = '/dashboard';
        }else{
          const msg = await res.text();
          pwdMsg.textContent = msg || 'Invalid credentials';
          pwdMsg.className = 'msg err';
        }
      }catch(err){
        pwdMsg.textContent = 'Network error: '+err.message;
        pwdMsg.className = 'msg err';
      }finally{
        hideOverlay();
      }
    });

    // Optional: wire SSO buttons
    document.getElementById('googleBtn').addEventListener('click',()=>{ window.location.href='/oauth2/authorization/google'; });
    document.getElementById('microsoftBtn').addEventListener('click',()=>{ window.location.href='/oauth2/authorization/azure'; });
  </script>
</body>
</html>
