<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Geekmonkey — Attendance</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
    <style>
        :root{
          /* Geekmonkey palette */
          --bg:#F9FAFB;           /* page background */
          --card:#FFFFFF;         /* cards */
          --stroke:#E5E7EB;       /* borders */
          --text:#111827;         /* primary text */
          --muted:#6B7280;        /* secondary text */
          --accent:#FF7A00;       /* Geekmonkey orange */
          --accent-600:#e86f00;
          --accent-100:#FFF2E8;
          --ok:#10B981;           /* present */
          --warn:#F59E0B;         /* late */
          --err:#EF4444;          /* absent */
          --info:#60A5FA;         /* leave */
          --radius:14px;
          --shadow:0 10px 20px rgba(17,24,39,.06), 0 2px 6px rgba(17,24,39,.04);
        }
        *{box-sizing:border-box}
        html,body{height:100%}
        body{margin:0;background:var(--bg);color:var(--text);font:14px/1.45 Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial}

        /* Header */
        .gm-header{position:sticky;top:0;z-index:1000;background:#fff;border-bottom:1px solid var(--stroke)}
        .gm-header-inner{max-width:1300px;margin:0 auto;padding:10px 16px;display:flex;align-items:center;gap:12px}
        .gm-brand{display:flex;align-items:center;gap:.6rem;text-decoration:none;color:var(--text)}
        .gm-logo{width:28px;height:28px;border-radius:8px;background:linear-gradient(135deg,var(--accent),#ffab66)}
        .gm-title{font-weight:800;letter-spacing:.2px}
        .gm-actions{margin-left:auto;display:flex;gap:8px}
        .gm-btn{display:inline-flex;align-items:center;gap:.5rem;border:1px solid var(--stroke);background:var(--card);border-radius:10px;padding:8px 12px;color:var(--text);text-decoration:none;font-weight:600;box-shadow:0 1px 0 rgba(0,0,0,.02)}
        .gm-btn:hover{border-color:#d9dde3;background:#fcfcfd}
        .gm-btn--accent{background:var(--accent);border-color:var(--accent);color:#fff}
        .gm-btn--accent:hover{background:var(--accent-600)}

        /* Layout */
        .wrap{max-width:1300px;margin:18px auto;padding:0 16px}
        .grid{display:grid;grid-template-columns:280px minmax(0,1fr) 320px;gap:16px}

        /* Cards */
        .card{background:var(--card);border:1px solid var(--stroke);border-radius:var(--radius);box-shadow:var(--shadow)}
        .card h3{margin:0 0 8px 0;font-size:16px}
        .card-body{padding:14px}
        .divider{height:1px;background:var(--stroke);margin:12px 0}

        /* Employee list */
        .emp-list{display:flex;flex-direction:column;gap:10px}
        .emp{display:flex;align-items:center;justify-content:space-between;gap:10px;border:1px solid var(--stroke);border-radius:12px;padding:10px}
        .emp-info{display:flex;align-items:center;gap:10px}
        .avatar{width:36px;height:36px;border-radius:50%;background:#ddd;flex:none}
        .emp-name{font-weight:600}
        .pill{padding:4px 8px;border-radius:999px;font-weight:700;font-size:12px}
        .pill.ok{background:#ECFDF5;color:#065F46}
        .pill.err{background:#FEF2F2;color:#991B1B}
        .pill.warn{background:#FFFBEB;color:#92400E}
        .pill.info{background:#EFF6FF;color:#1E40AF}

        /* Middle column */
        .toolbar{display:flex;align-items:center;gap:8px;margin-bottom:10px}
        .search{flex:1;position:relative}
        .search input{width:100%;border:1px solid var(--stroke);border-radius:10px;padding:10px 12px 10px 34px}
        .search i{position:absolute;left:10px;top:10px;color:var(--muted)}

        .calendar{border:1px solid var(--stroke);border-radius:12px;overflow:hidden}
        .calendar-head{display:flex;align-items:center;justify-content:space-between;padding:10px 12px;background:#F3F4F6}
        .calendar-grid{display:grid;grid-template-columns:repeat(7,1fr);border-top:1px solid var(--stroke)}
        .dow, .day{padding:10px;border-right:1px solid var(--stroke);border-bottom:1px solid var(--stroke);text-align:center}
        .dow{font-weight:700;background:#FAFAFA}
        .day.is-range{background:var(--accent-100)}
        .day .tag{display:inline-block;margin-top:6px;padding:2px 6px;border-radius:999px;font-size:11px;font-weight:700}
        .tag.ok{background:#DCFCE7;color:#166534}
        .tag.warn{background:#FEF3C7;color:#92400E}
        .tag.err{background:#FEE2E2;color:#991B1B}
        .tag.info{background:#DBEAFE;color:#1E40AF}

        .table{margin-top:12px;border:1px solid var(--stroke);border-radius:12px;overflow:hidden}
        table{width:100%;border-collapse:separate;border-spacing:0}
        thead th{background:#F9FAFB;font-size:12px;text-transform:uppercase;letter-spacing:.04em}
        th,td{padding:10px 12px;border-bottom:1px solid var(--stroke)}

        /* Right column */
        .stats{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
        .stat{border:1px solid var(--stroke);border-radius:12px;padding:14px;text-align:center;font-weight:800}
        .stat.ok{background:#ECFDF5;color:#065F46}
        .stat.warn{background:#FFFBEB;color:#92400E}
        .stat.err{background:#FEF2F2;color:#991B1B}
        .stat.info{background:#EFF6FF;color:#1E40AF}
        .legend{margin-top:10px}
        .legend li{display:flex;align-items:center;gap:8px;margin:6px 0;color:var(--muted)}
        .dot{width:10px;height:10px;border-radius:50%}

        .manual{margin-top:12px}
        .field{display:flex;flex-direction:column;gap:6px;margin-bottom:10px}
        .input, select{border:1px solid var(--stroke);border-radius:10px;padding:10px}
        .btn{display:inline-flex;align-items:center;gap:8px;border:none;border-radius:12px;padding:10px 14px;background:var(--accent);color:#fff;font-weight:800;cursor:pointer}
        .btn:hover{background:var(--accent-600)}
        .btn.secondary{background:#111827;color:#fff}

        /* Modal */
        .modal-backdrop{position:fixed;inset:0;background:rgba(17,24,39,.5);display:none;align-items:center;justify-content:center;z-index:2000}
        .modal{width:min(720px,94vw);background:#fff;border:1px solid var(--stroke);border-radius:16px;box-shadow:var(--shadow);overflow:hidden}
        .modal-hd{display:flex;align-items:center;justify-content:space-between;padding:12px 16px;border-bottom:1px solid var(--stroke);background:#FAFAFA}
        .modal-bd{padding:16px}
        .modal-ft{display:flex;gap:8px;justify-content:flex-end;padding:12px 16px;border-top:1px solid var(--stroke);background:#FAFAFA}
        .hidden{display:none}

        /* Camera preview */
        .camera{display:grid;grid-template-columns:1fr 260px;gap:16px}
        video,canvas{width:100%;border:1px solid var(--stroke);border-radius:12px}

        /* Mobile */
        @media (max-width: 1024px){
          .grid{grid-template-columns:1fr}
          .camera{grid-template-columns:1fr}
        }
    </style>
</head>
<body>
<!-- Header -->
<header class="gm-header">
    <div class="gm-header-inner">
        <a class="gm-brand" href="#" onclick="return goBack()" title="Back">
            <span class="gm-logo" aria-hidden="true"></span>
            <span class="gm-title">Geekmonkey · Attendance</span>
        </a>
        <div class="gm-actions">
            <a class="gm-btn" href="#" onclick="return goBack()"><i class="fa-solid fa-arrow-left"></i><span>Back</span></a>
            <a class="gm-btn gm-btn--accent" href="/v1/home"><i class="fa-solid fa-house"></i><span>Home</span></a>
        </div>
    </div>
</header>

<main class="wrap">
    <div class="grid">
        <!-- Left: Employee List -->
        <section class="card">
            <div class="card-body">
                <h3>Employee List</h3>
                <div class="divider"></div>
                <div class="emp-list" id="empList">
                    <!-- Filled by JS so we can tag latecomers -->
                </div>
            </div>
        </section>

        <!-- Middle: Calendar + Table -->
        <section>
            <div class="card card-body">
                <div class="toolbar">
                    <div class="search"><i class="fa-solid fa-magnifying-glass"></i><input placeholder="Search employees or dates"/></div>
                    <button class="gm-btn" type="button" id="btnAutoCheck"><i class="fa-solid fa-bolt"></i> Auto Check‑In</button>
                    <button class="gm-btn" type="button" id="btnManualEntry"><i class="fa-solid fa-plus"></i> Add manual entry</button>
                </div>
                <div class="calendar" aria-label="April 2024 Calendar">
                    <div class="calendar-head">
                        <strong>April 2024</strong>
                        <button class="gm-btn" type="button"><i class="fa-solid fa-sliders"></i> Filter</button>
                    </div>
                    <div class="calendar-grid">
                        <div class="dow">D</div><div class="dow">Mo</div><div class="dow">Tu</div><div class="dow">We</div><div class="dow">Th</div><div class="dow">Fr</div><div class="dow">Sa</div>
                        <!-- Row 1 -->
                        <div class="day">&nbsp;</div><div class="day">1</div><div class="day">2</div><div class="day">3</div><div class="day">4</div><div class="day">5</div><div class="day">6</div>
                        <!-- Row 2 -->
                        <div class="day">7</div><div class="day">8</div><div class="day">9</div><div class="day is-range">10</div><div class="day is-range">11</div><div class="day is-range">12</div><div class="day is-range">13</div>
                        <!-- Row 3 -->
                        <div class="day is-range">14</div><div class="day is-range">15</div><div class="day is-range">16</div><div class="day is-range">17</div><div class="day">18</div><div class="day">19</div><div class="day">20</div>
                        <!-- Row 4 -->
                        <div class="day">21</div><div class="day">22</div><div class="day">23</div><div class="day">24</div><div class="day">25</div><div class="day">26</div><div class="day">27</div>
                        <!-- Row 5 -->
                        <div class="day">28</div><div class="day">29</div><div class="day">30</div><div class="day">&nbsp;</div><div class="day">&nbsp;</div><div class="day">&nbsp;</div><div class="day">&nbsp;</div>
                    </div>
                </div>

                <div class="table">
                    <table>
                        <thead><tr><th style="width:42%">Name</th><th>Check‑In</th><th>Check‑Out</th><th>Status</th></tr></thead>
                        <tbody id="tblBody">
                        <!-- filled by JS to reflect latecomers -->
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Right: Stats + Manual Entry (Admin‑locked) -->
        <aside class="card">
            <div class="card-body">
                <div class="stats">
                    <div class="stat ok">22<br><small>Present</small></div>
                    <div class="stat warn">3<br><small>Late</small></div>
                    <div class="stat err">2<br><small>Absent</small></div>
                    <div class="stat info">5<br><small>Leave</small></div>
                </div>
                <ul class="legend">
                    <li><span class="dot" style="background:var(--ok)"></span> Present</li>
                    <li><span class="dot" style="background:var(--warn)"></span> Late</li>
                    <li><span class="dot" style="background:var(--err)"></span> Absent</li>
                    <li><span class="dot" style="background:var(--info)"></span> WFH / Leave</li>
                </ul>

                <div class="divider"></div>
                <h3>Latecomers (Today)</h3>
                <ul id="lateList" style="padding-left:18px;margin:8px 0 16px 0"></ul>
                <div class="divider"></div>

                <div class="manual">
                    <h3>Manual Entry <small style="color:var(--muted)">(Admin only)</small></h3>
                    <div id="adminLock">
                        <div class="field"><label>Admin Password</label><input id="adminPass" class="input" type="password" placeholder="Enter password to unlock"/></div>
                        <button class="btn secondary" id="unlockBtn" type="button"><i class="fa-solid fa-lock"></i> Unlock</button>
                    </div>
                    <div id="manualForm" class="hidden">
                        <div class="field"><label>Employee</label><input id="mfEmployee" class="input" placeholder="Select or search"/></div>
                        <div class="field"><label>Date</label><input id="mfDate" class="input" type="date"/></div>
                        <div class="field"><label>Time</label><input id="mfTime" class="input" type="time"/></div>
                        <div class="field"><label>Type</label>
                            <select id="mfType">
                                <option>Check‑In</option>
                                <option>Check‑Out</option>
                                <option>WFH</option>
                                <option>Leave</option>
                            </select>
                        </div>
                        <button class="btn" type="button" id="mfAdd"><i class="fa-solid fa-plus"></i> Add</button>
                    </div>
                </div>
            </div>
        </aside>
    </div>
</main>

<!-- Auto Check‑In Modal -->
<div class="modal-backdrop" id="autoModal">
    <div class="modal">
        <div class="modal-hd">
            <strong><i class="fa-solid fa-bolt"></i> Auto Check‑In</strong>
            <button class="gm-btn" id="closeAuto" type="button"><i class="fa-solid fa-xmark"></i> Close</button>
        </div>
        <div class="modal-bd">
            <div class="camera">
                <div>
                    <video id="cam" autoplay playsinline></video>
                </div>
                <div>
                    <canvas id="snap" width="480" height="360"></canvas>
                    <div class="field"><label>Timestamp (IST)</label>
                        <input id="istNow" class="input" readonly />
                    </div>
                    <button class="btn" id="btnCapture" type="button"><i class="fa-solid fa-camera"></i> Capture</button>
                </div>
            </div>
        </div>
        <div class="modal-ft">
            <button class="gm-btn" id="btnRetake" type="button"><i class="fa-solid fa-rotate"></i> Retake</button>
            <button class="btn" id="btnSaveCheckin" type="button"><i class="fa-solid fa-circle-check"></i> Check‑In</button>
        </div>
    </div>
</div>

<script>
    function goBack(){
      if (window.history.length > 1) { window.history.back(); }
      else { window.location.href = '/v1/home'; }
      return false;
    }

    // --- Data (hard‑coded latecomers for now) ---
    const employees = [
      { name:'Emma Johnson', dept:'Design', status:'present' },
      { name:'Anne Johns', dept:'Operations', status:'late' },
      { name:'Late Lang', dept:'Support', status:'absent' },
      { name:'Wokort Frown', dept:'WFH', status:'leave' },
      { name:'Sarah Taylor', dept:'Sales', status:'absent' },
      { name:'Jane Dever', dept:'Admin', status:'leave' },
    ];
    const lateToday = ['Anne Johns','Jane Smith']; // hardcoded list

    // Fill employee list with status pills
    const empList = document.getElementById('empList');
    const tblBody = document.getElementById('tblBody');
    const lateList = document.getElementById('lateList');

    function pillClass(s){
      if(s==='present') return 'pill ok';
      if(s==='late') return 'pill warn';
      if(s==='absent') return 'pill err';
      return 'pill info';
    }
    function tagClass(s){
      if(s==='present') return 'tag ok';
      if(s==='late') return 'tag warn';
      if(s==='absent') return 'tag err';
      return 'tag info';
    }

    employees.forEach(e=>{
      const div = document.createElement('div');
      div.className='emp';
      div.innerHTML = `<div class="emp-info"><div class="avatar"></div><div><div class="emp-name">${e.name}</div><div class="muted">${e.dept}</div></div></div><div class="${pillClass(e.status)}">${e.status==='present'?'Present':e.status==='late'?'Late':e.status==='absent'?'Absent':'On leave'}</div>`;
      empList.appendChild(div);
    });

    // Fill table rows & late list
    const sampleRows = [
      {name:'Jane Smith', in:'9:10 AM', out:'5:15 PM', status:'late'},
      {name:'Robert Brown', in:'—', out:'—', status:'absent'},
      {name:'David Wilson', in:'WFH', out:'—', status:'leave'},
      {name:'Sarah Taylor', in:'On leave', out:'On leave', status:'leave'},
    ];

    sampleRows.forEach(r=>{
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${r.name}</td><td>${r.in}</td><td>${r.out}</td><td><span class="${tagClass(r.status)}">${r.status==='late'?'Late':r.status==='absent'?'Absent':'On leave'}</span></td>`;
      tblBody.appendChild(tr);
    });

    lateToday.forEach(n=>{
      const li=document.createElement('li');
      li.textContent=n;
      lateList.appendChild(li);
    });

    // --- Admin‑only manual entry ---
    const ADMIN_PASSWORD = 'geekadmin123'; // change in prod; verify on server in real app
    const unlockBtn = document.getElementById('unlockBtn');
    unlockBtn?.addEventListener('click', ()=>{
      const pass = (document.getElementById('adminPass')||{}).value || '';
      if(pass === ADMIN_PASSWORD){
        document.getElementById('adminLock').classList.add('hidden');
        document.getElementById('manualForm').classList.remove('hidden');
      } else {
        alert('Invalid password.');
      }
    });

    document.getElementById('mfAdd')?.addEventListener('click', ()=>{
      const emp = document.getElementById('mfEmployee').value;
      const date = document.getElementById('mfDate').value;
      const time = document.getElementById('mfTime').value;
      const type = document.getElementById('mfType').value;
      console.log('Manual entry (admin):', {emp,date,time,type});
      alert('Manual entry saved (demo).');
    });

    // --- Auto Check‑In (camera + IST time) ---
    const autoModal = document.getElementById('autoModal');
    const btnAuto = document.getElementById('btnAutoCheck');
    const closeAuto = document.getElementById('closeAuto');
    const cam = document.getElementById('cam');
    const snap = document.getElementById('snap');
    const btnCapture = document.getElementById('btnCapture');
    const btnRetake = document.getElementById('btnRetake');
    const btnSaveCheckin = document.getElementById('btnSaveCheckin');
    const istNow = document.getElementById('istNow');
    let stream=null, lastPhoto=null;

    function formatIST(d){
      // Client time formatted as IST. For server‑trusted time, fetch from backend (e.g., NTP/time.google.com)
      return new Intl.DateTimeFormat('en-IN',{
        timeZone:'Asia/Kolkata', year:'numeric', month:'2-digit', day:'2-digit',
        hour:'2-digit', minute:'2-digit', second:'2-digit', hour12:true
      }).format(d);
    }

    function tickIST(){ istNow.value = formatIST(new Date()); }
    let istTimer=null;

    async function openAuto(){
      autoModal.style.display='flex';
      tickIST();
      istTimer = setInterval(tickIST, 1000);
      try{
        stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode:'user' } });
        cam.srcObject = stream;
      }catch(e){
        alert('Camera access failed: '+ e.message);
      }
    }
    function closeAutoFn(){
      autoModal.style.display='none';
      clearInterval(istTimer); istTimer=null;
      if(stream){ stream.getTracks().forEach(t=>t.stop()); stream=null; }
      const ctx = snap.getContext('2d'); ctx.clearRect(0,0,snap.width,snap.height); lastPhoto=null;
    }

    btnAuto.addEventListener('click', openAuto);
    closeAuto.addEventListener('click', closeAutoFn);

    btnCapture.addEventListener('click', ()=>{
      const ctx = snap.getContext('2d');
      // draw video to canvas
      const w = snap.width, h = snap.height;
      ctx.drawImage(cam, 0, 0, w, h);
      lastPhoto = snap.toDataURL('image/png');
    });

    btnRetake.addEventListener('click', ()=>{
      const ctx = snap.getContext('2d'); ctx.clearRect(0,0,snap.width,snap.height); lastPhoto=null;
    });

    btnSaveCheckin.addEventListener('click', ()=>{
      if(!lastPhoto){ alert('Please capture a photo first.'); return; }
      const timestamp = istNow.value; // IST formatted
      // In production: send to backend along with employee id, geolocation, etc.
      console.log('Auto Check‑In saved', { timestamp, photo:lastPhoto.slice(0,40)+'...' });
      alert('Auto Check‑In recorded at '+ timestamp + ' (demo)');
      closeAutoFn();
    });

    // Manual entry button in toolbar should also respect admin lock
    document.getElementById('btnManualEntry').addEventListener('click', ()=>{
      const lock = document.getElementById('adminLock');
      if(lock && !lock.classList.contains('hidden')){
        alert('Manual check‑in is admin only. Please unlock with password.');
        document.getElementById('adminPass').focus();
      } else {
        document.getElementById('mfEmployee').focus();
      }
    });
</script>
</body>
</html>
